# Copyright 2025 Dell Inc. or its subsidiaries. All Rights Reserved.
#
#  Licensed under the Apache License, Version 2.0 (the "License");
#  you may not use this file except in compliance with the License.
#  You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
#  Unless required by applicable law or agreed to in writing, software
#  distributed under the License is distributed on an "AS IS" BASIS,
#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#  See the License for the specific language governing permissions and
#  limitations under the License.
---

- name: Initialize supported_os_version_status
  ansible.builtin.set_fact:
    supported_os_version_status: false

- name: Validate federated_provision
  ansible.builtin.fail:
    msg: "{{ federated_provision_unsupported }}"
  when: federated_provision

- name: Set provision_os in lowercase
  ansible.builtin.set_fact:
    provision_os: "{{ provision_os | lower }}"

- name: Validate input parameters of provision vars are not empty
  ansible.builtin.fail:
    msg: "{{ input_provision_fail_msg }}"
  when: language | default("", true) | length < 1

- name: Set supported_os_version_status to true - rhel
  ansible.builtin.set_fact:
    supported_os_version_status: true
  with_items: "{{ supported_rhel_os_version }}"
  when:
    - provision_os_version | string  == item | string
    - provision_os | lower == os_supported_rhel

- name: Validate provision_os_version is supported
  ansible.builtin.fail:
    msg: "{{ provision_os_version_fail_msg }}"
  when: not supported_os_version_status

- name: Validate ubuntu_kernel_flavor
  ansible.builtin.assert:
    that:
      - ubuntu_kernel_flavor == "hwe" or ubuntu_kernel_flavor == "generic"
    fail_msg: "{{ ubuntu_kernel_fail_msg }}"
  when:
    - provision_os | lower == os_supported_ubuntu
    - provision_os_version | string == ubuntu22_version
    - ubuntu_kernel_flavor is defined

- name: Assert ntp_support
  ansible.builtin.assert:
    that:
      - ntp_support == true or ntp_support == false
    fail_msg: "{{ ntp_support_fail_msg }}"
